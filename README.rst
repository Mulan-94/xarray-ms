================================
xarray Datasets from CASA Tables
================================

Constructs xarray_ ``Datasets`` from CASA Tables via python-casacore_.
The ``DataArrays`` contained in the ``Dataset`` are dask_ arrays backed by
deferred calls to :code:`pyrap.tables.table.getcol`.

Supports writing ``DataArrays`` back to the respective column in the Table.

The intention behind this package is to support the Measurement Set as
a data source and sink for the purposes of writing parallel, distributed
Radio Astronomy algorithms.

.. code-block:: python

    import dask.array as da
    from xarray_ms import xds_from_table, xds_to_table

    # Create xarray dataset from Measurement Set "WSRT.MS"
    ds = xds_from_table("WSRT.MS", time_ordered=True, chunks=10000, table_schema="MS")
    # Set the flag DataArray to it's inverse
    ds['flag'] = (ds.flag.dims, da.logical_not(ds.flag))
    # Write the flag column back to the Measurement Set
    xds_to_table(ds, "FLAG").compute()

    print ds

    <xarray.Dataset>
    Dimensions:         (chans: 64, corrs: 4, rows: 6552, u,v,w: 3)
    Coordinates:
      * rows            (rows) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ...
        msrows          (rows) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ...
    Dimensions without coordinates: chans, corrs, u,v,w
    Data variables:
        weight          (rows, corrs) float32 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 ...
        processor_id    (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
        uvw             (rows, u,v,w) float64 -126.8 59.13 -34.13 -253.6 118.3 ...
        imaging_weight  (rows, chans) float32 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 ...
        antenna2        (rows) int32 1 2 3 4 5 6 7 8 9 10 11 12 13 2 3 4 5 6 7 8 ...
        antenna1        (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 ...
        time_centroid   (rows) float64 4.457e+09 4.457e+09 4.457e+09 4.457e+09 ...
        array_id        (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
        observation_id  (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
        data_desc_id    (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
        feed1           (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
        feed2           (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
        scan_number     (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
        flag_row        (rows) bool False False False False False False False ...
        corrected_data  (rows, chans, corrs) complex64 (10+0j) (0.000240935+0j) ...
        field_id        (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
        flag            (rows, chans, corrs) bool True True True True True True ...
        data            (rows, chans, corrs) complex64 1j 1j 1j 1j 1j 1j 1j 1j ...
        exposure        (rows) float64 600.0 600.0 600.0 600.0 600.0 600.0 600.0 ...
        model_data      (rows, chans, corrs) complex64 (10+0j) 0j 0j (10+0j) ...
        interval        (rows) float64 600.0 600.0 600.0 600.0 600.0 600.0 600.0 ...
        time            (rows) float64 4.457e+09 4.457e+09 4.457e+09 4.457e+09 ...
        state_id        (rows) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
        sigma           (rows, corrs) float32 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 ...
    Attributes:
        runs:     [array([   0,    1,    2, ..., 6549, 6550, 6551])]
        ms:       WSRT.MS

-----------
Limitations
-----------

1. Many Measurement Sets columns are defined as variably shaped,
   but the actual data is fixed.
   For this reason, xarray-ms_ will infer the shape of the
   data from the first row and must be consistent
   with that of other rows.

.. _dask: https://dask.pydata.org
.. _xarray-ms: pants
.. _xarray: https://xarray.pydata.org
.. _python-casacore: https://github.com/casacore/python-casacore